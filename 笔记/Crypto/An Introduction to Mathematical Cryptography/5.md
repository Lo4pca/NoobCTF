# Combinatorics, Probability, and Information Theory

（试了几道课后题，我去我的概率差得没边了）

目前最讨厌的一节，一堆新记号放在一起感觉脑子要炸了。题目做起来也枯燥乏味，solution manual的答案也不全。跳过一些题好了

## Exercise 5.20

4. 假设 $E_1,E_2,E_3$ 均为事件（event），证明 $Pr(E_1\cup E_2\cup E_3)=Pr(E_1)+Pr(E_2)+Pr(E_3)-Pr(E_1\cap E_2)-Pr(E_1\cap E_3)-Pr(E_2\cap E_3)+Pr(E_1\cap E_2\cap E_3)$

`2`的结论比较简单： $Pr(E\cup F)=Pr(E)+Pr(F)-Pr(E\cap F)$ ,这里直接用

把 $E_1\cup E_2$ 看成一个事件， $Pr((E_1\cup E_2)\cup E_3)=Pr(E_1\cup E_2)+Pr(E_3)-Pr((E_1\cup E_2)\cap E_3)$

- $Pr(E_1\cup E_2)=Pr(E_1)+Pr(E_2)-Pr(E_1\cap E_2)$
- $Pr((E_1\cup E_2)\cap E_3)=Pr(E_1\cap E_3)+Pr(E_2\cap E_3)-Pr(E_1\cap E_2\cap E_3)$ (如果 $E_1$ 和 $E_2$ 之间无交集，自然【两者的并】与 $E_3$ 取交集的结果就是 $E_1$ 、 $E_2$ 分别与 $E_3$ 取交集。但如果两者的交集不为空且交集中存在与 $E_3$ 相同的元素，则按刚才那种算法计算后，那些元素的概率被算了两次，所以需要减掉)

拼起来就能得到题目要求证明的式子

## Exercise 5.26

思考`Example 5.26`描述的三名囚徒。令A、B和C分别表示 Alice 被释放、Bob 被释放和 Carl 被释放这三个事件，我们假设它们发生的概率相等，因此 $Pr(A) = Pr(B) = Pr(C) = \frac{1}{3}$ 。此外，让J表示“狱卒告诉Alice：Bob会被留在监狱”的事件

（这题需要的相关公式从`5.18`开始）

1. 计算Pr(B | J), Pr(J | B), 和 Pr(J | C)

Pr(B | J)很明显是0，反过来的Pr(J | B)也是

Pr(J | C)是 1 ，因为如果Carl被释放了（条件概率默认C已经发生，所以只需考虑在C发生的“世界”中，J发生的概率），J一定会发生

2. 计算 $Pr(J|A^c)$ 和 $Pr(J^c|A^c)$ ，其中 $A^c$ 表示Alice留在监狱的事件

如果Alice会留在监狱，被释放的就是Carl或者Bob。 $Pr(J|A^c)=\frac{1}{2}$

$J^c$ 我不确定是什么意思，这里假设是狱卒无法告知Bob会留在监狱，意味着Bob被释放了。那么概率仍然是 $\frac{1}{2}$

3. 假设要释放的是Alice，然后狱卒通过抛硬币决定“是否告诉Alice：Bob或Carl会留在监狱”。Pr(A|J)的值是什么？

用公式 $Pr(E|F)=\frac{Pr(F|E)Pr(E)}{Pr(F)}$

- $Pr(J)=\frac{1}{2}$
- $Pr(J|A)=\frac{1}{2}$
- $Pr(A)=\frac{1}{3}$

所以 $Pr(A|J)=\frac{\frac{1}{2}\times\frac{1}{3}}{\frac{1}{2}}=\frac{1}{3}$

4. 仍然假设要释放的是Alice，但狱卒永远告知Alice：Bob会留在监狱。此时Pr(A|J)的值是什么？

- $Pr(J)=\frac{2}{3}$ （注意J只代表Alice被告知Bob会留在监狱的概率，与Alice是否被释放没有关系。在这一小题的假设下，J只在Bob被释放时不会发生，即 $\frac{2}{3}$ 的概率发生）
- $Pr(J|A)=1$
- $Pr(A)=\frac{1}{3}$

所以 $Pr(A|J)=\frac{1\times\frac{1}{3}}{\frac{2}{3}}=\frac{1}{2}$

这题神奇的一点在于，Pr(A|J)的值会根据狱卒的行为变化，非常反直觉。但如果用条件概率的定义考虑就没那么反直觉了：Pr(A|B)在B已经发生的世界中找A也发生的概率，意味着A的概率与B发生后的世界，即Pr(B)的大小有关

（感谢deepseek在这题对我的帮助，相比chatgpt的胡言乱语来说它的解答清晰多了）

（我老是理解错题目的意思。比如“假设要释放的是Alice”，我就以为这表示Pr(A)=1……）

## Exercise 5.27

(The Monty Hall Problem) Monty Hall让Dan从三扇窗帘中选择一个。其中一个窗帘后是一辆车，其余两个窗帘后是山羊。Dan选了一扇窗帘，但在他打开窗帘之前，Monty Hall打开了另一扇窗帘，露出了里面的山羊。然后，他让Dan选择是保留他最初选择的窗帘，还是换成剩下的那扇没打开的窗帘。Monty Hall Problem旨在找出Dan的最佳策略：“是否改变选择？”

（似乎流传更广的名称是“三门问题”）

1. 如果Dan坚持选择他最初选择的窗帘，他赢得汽车的概率是多少？如果他更换选择的窗帘，他赢得汽车的概率又是多少？哪种策略是他的最佳策略？（如果答案有些反直觉，假设有1000扇窗帘，Monty Hall打开了998扇背后是山羊的窗帘。此时这两种策略的获胜概率分别是多少？）

我本来觉得经过上一题后我总算是摸到点概率问题的门路了，结果这题仍然不确定怎么做。事件是啥啊？

假设W代表拿到车的事件，S是改变选择，那么 $S^c$ 是不改变选择？

$Pr(W|S^c)=\frac{1}{3}$ ，因为如果不改变选择的话，最初的选择拿到车的概率就是 $\frac{1}{3}$

Pr(W|S)就比较难算了，不知道怎么用公式。Pr(S|W)和Pr(S)都不知道是啥玩意（是不是因为我事件选得不好？）。那么直接列出所有可能性？假设三扇门（还是门说起来顺口）分别是A、B和C，需要独立计算Dan的选择和车所在的门：
- 假设Dan选择A，记作 $Pr(C_A)=\frac{1}{3}$
- 假设车在A后，记作 $Pr(W_A)=\frac{1}{3}$
- “Dan的选择”和“车所在的位置”这两个事件是独立的，所以任何 $Pr(C_X\cap W_X)=\frac{1}{3}\times\frac{1}{3}=\frac{1}{9}$
- 然后开始枯燥地列式（假设Monty随机开门）：
    - 车在A，Dan选A（ $\frac{1}{9}$ ）
        - 开C，换B（开C的概率 $\frac{1}{2}$ 乘上进入上一个分支的概率 $\frac{1}{9}$ ，结果是 $\frac{1}{18}$ ）
        - 开B，换C（ $\frac{1}{18}$ ）
    - 车在A，Dan选B（ $\frac{1}{9}$ ）
        - 开C，换A（因为Monty不可能打开有车的门，所以进入这个分支的概率等于上一个节点的概率 $\frac{1}{9}$ ）
    - 车在A，Dan选C（ $\frac{1}{9}$ ）
        - 开B，换C（ $\frac{1}{9}$ ）
- 车在B和C的情况与上方类似

把所有子节点的概率加起来，得到：
- 换门后失败的概率是 $\frac{1}{18}\times 2=\frac{1}{9}$
- 换门后成功的概率是 $\frac{1}{9}\times 2=\frac{2}{9}$

加上车在B和C后的情况，总失败概率是 $\frac{1}{9}\times 3=\frac{1}{3}$ ；总成功概率是 $\frac{2}{9}\times 3=\frac{2}{3}$

$Pr(W|S)=\frac{2}{3}$

从上面可以看出，除非最开始就选中背后是车的那道门，剩下的所有情况都是换门才能得到车。那么1000扇门的情况也符合这个规律：不换门得到车的概率是 $\frac{1}{1000}$ ，换门得到车的概率是 $\frac{999}{1000}$

2. 假设Monty Hall有了另一种选择，允许他强迫Dan坚持选择他最初选择的窗帘。假设Monty Hall不喜欢送出车，Dan的最佳策略是什么？他赢得车的概率是多少？

这题好奇怪啊，意思是Dan即使选择更换窗帘，Monty也能强迫他不更换？

参考上一题列的式子，如果Dan最开始没有选到车，那么Monty直接不允许他换窗帘，一切就结束了；如果Dan一开始选到了，换窗帘后便得不到车。所以“更换窗帘”在这题的条件下得到车的概率是0

这题的最佳策略应该是“不更换窗帘”，有 $\frac{1}{3}$ 的概率得到车

3. 更一般地，假设有N扇窗帘和M辆车，且Monty Hall打开了K扇背后是山羊的窗帘。计算以下概率：
- Pr(Dan赢得一辆车|Dan不更换选择)
- Pr(Dan赢得一辆车|Dan更换选择)

哪种策略更好？

仍然假设W代表拿到车的事件，S是改变选择， $S^c$ 是不改变选择

- $Pr(W|S^c)=\frac{M}{N}$

Pr(W|S)要更复杂。需要分成两种情况。 $C_0$ 表示第一次选到了山羊， $C_1$ 表示第一次选到了车
- 假如最开始选到了车（ $\frac{M}{N}$ ），Monty打开了K扇门。此时换门再次换到车的概率是 $Pr(W|C_1,S)=\frac{M-1}{N-K-1}$
- 假如最开始选到了山羊（ $\frac{N-M}{N}$ ），此时换门得到车的概率是 $Pr(W|C_0,S)=\frac{M}{N-K-1}$
- 把它们拼在一起： $Pr(W|S)=Pr(C_1)\times Pr(W|C_1,S)+Pr(C_0)\times Pr(W|C_0,S)=\frac{M}{N}\times\frac{M-1}{N-K-1}+\frac{N-M}{N}\times\frac{M}{N-K-1}=\frac{M (N - 1)}{N ( N - K - 1)}$

$\frac{M (N - 1)}{N ( N - K - 1)}$ > $\frac{M}{N}\Rightarrow\frac{N - 1}{N - K - 1}$ > 1，等价于K大于0。因此换门永远是更好的选择（不开门就不算三门问题了对吧？）

（全是deepseek写的。我真不会概率）

## Exercise 5.28

假设S是一个集合，A为我们感兴趣的性质；再假设对于某个 $m\in S$ ，其Pr(m不具有性质A)= $\delta$ 。进一步假设对m应用蒙特卡洛（Monte Carlo）算法时满足：
- 如果算法返回Yes，则m一定具有性质A
- 如果m具有性质A，则算法返回Yes的概率至少是p

可以将上述两个性质重写为条件概率：
- Pr(m具有性质A|算法返回Yes)=1
- Pr(算法返回Yes|m具有性质A) $\geq p$

假设我们在m上运行了N次算法，且算法每次都返回No。推导出“m不具有性质A”的概率的下界，用 $\delta,p,N$ 表示

用`5.21`的Bayes’s formula：

$$Pr(E|F)=\frac{Pr(F|E)Pr(E)}{Pr(F|E)Pr(E)+Pr(F|E^c)Pr(E^c)}$$

这题的F为“算法连续N次返回No”，E为“m不具有性质A”

- Pr(F|E)=1
    - 根据算法的描述，它只会误判具有性质A的元素，将其判定为No；处理不具有性质A的元素时返回的一定是No，永远不会将其判成Yes
- $Pr(E)=\delta$
- $Pr(F|E^c)\leq(1-p)^N$
    - $E^c$ 为“m具有性质a”
    - $Pr(算法返回No|E^c)\leq 1-p$
    - $Pr(F|E^c)=Pr(算法返回No|E^c)^N=(1-p)^N$
- $Pr(E^c)=1-\delta$
- 拼起来： $Pr(E|F)\geq\frac{\delta}{\delta+(1-p)^N(1-\delta)}$

还是得用公式。我最开始想着模仿上一题的做法搞枚举（属于是路径依赖了），结果半天得不到结果。偷看solution manual找到了该用的公式后很快就做出来了

## Exercise 5.33

此题学习并扩展`Example 5.37`中使用的技巧：用微分计算无穷级数的值

|x| < 1时的等比级数公式：

$$\sum^{\infty}_{n=0}x^n=\frac{1}{1-x}$$

一个微分算子（differential operator）：

$$D = x\frac{d}{dx}$$

1. 利用 $D(x^n) = nx^n$ 这一事实，通过在下列式子的两边应用D，证明:

$$\sum^{\infty}_{n=1}nx^n=\frac{x}{(1-x)^2}$$

x为什么值时，上式的左侧收敛？

提示：使用比值审敛法（ratio test）

等比级数的另一个等价形式为 $\sum^{\infty}_{n=1}x^n=\frac{x}{1-x}$

微分算子的一个性质是：如果两边是相等的函数，那么对它们同时作用同一个算子，结果仍然相等

首先右边有 $D(\frac{x}{1-x})=x\frac{1}{(1-x)^2}=\frac{x}{(1-x)^2}$

然后左边有 $D(\sum^{\infty}_{n=1}x^n)=\sum^{\infty}_{n=1}D(x^n)=\sum^{\infty}_{n=1}nx^n$ （算子是线性的，可以逐项作用）

这样就得到了题目要求证明的形式

比值审敛法需要看 $L=lim_{n\rightarrow\infty}|\frac{a_{n+1}}{a_n}|$ ，这题有 $L=lim_{n\rightarrow\infty}|\frac{(n+1)x^{n+1}}{nx^n}|=|x|$ 。只要|x| < 1，则级数收敛；|x| > 1则级数发散

|x|=1的情况需要额外验证；无论是x=1还是x=1， $\sum n$ 和 $\sum n(-1)^n$ 均是发散的

2. 再次应用D，证明: 

$$\sum_{n=0}^{\infty}n^2x^n=\frac{x+x^2}{(1-x)^3}$$

接着上一小题的结论故技重施：

$D(\frac{x}{(1-x)^2})=x\frac{1+x}{(1-x)^3}=\frac{x+x^2}{(1-x)^3}$

$D(\sum^{\infty}_{n=1}nx^n)=\sum^{\infty}_{n=1}D(nx^n)=\sum^{\infty}_{n=1}n^2x^n$

虽然原结论的级数下标是1，但是改成0后没有任何影响，因为 $n^2x^n=0$

3. 更一般地，证明对每个k值，都存在一个多项式 $F_k(x)$ ，使得：

$$\sum^{\infty}_{n=0}n^kx^n=\frac{F_k(x)}{(1-x)^{k+1}}$$

提示：对k使用归纳法

先假设命题对k成立，然后看k+1的情况：

$D(\sum^{\infty}_{n=0}n^{k}x^n)=n^{k+1}x^{n}$

另一半更复杂些，目标是证明 $D(\frac{F_k(x)}{(1-x)^{k+1}})=\frac{F_{k+1}(x)}{(1-x)^{k+2}}$ 。首先把这个函数看成 $u(x)=F_k(x)$ 和 $v(x)=(1-x)^{-k-1}$ 两个函数的乘积，所以 $D(u(x)v(x))=x\frac{d}{dx}[uv]=x[u'v+uv']$

然后用链式法则求v'(x)。把1-x看成g(x)， $x^{-k-1}$ 看成f(x)，则v'(x)=f'(g(x))g'(x)
- $f'(x)=(-k-1)x^{-k-2}$
- $g'(x)=-1$
- $f'(g(x))=(-k-1)(1-x)^{-k-2}$
- $v'(x)=(k+1)(1-x)^{-k-2}$

拼起来得到 $D(u(x)v(x))=x[F_k'(x)(1-x)^{-k-1}+F_k(x)(k+1)(1-x)^{-k-2}]$

为了与要证明的式子的分母的指数k+2匹配，提一个公因式： $(1-x)^{-k-2}[F_k'(x)x(1-x)+F_k(x)(k+1)]$ 。记方括号内的多项式为 $F_{k+1}(x)$ 即可

前面两道小题已经证过对n=1和n=2时成立，完成归纳法

## Exercise 5.38

1. 证明 $\forall x,e^{-x}\geq 1-x$

提示：画图或是用微积分计算函数 $f(x)=e^{-x}-(1-x)$ 的最小值

desmos画图能发现 $e^{-x}$ 的图像永远在1-x的图像的上面，只在(0,1)处有一个交点

$f'(x)=1-e^{-x}$ ，根为x=0。其二阶导数为 $e^{-x}$ ，代入x=0后得到1，说明这是局部极小值

又因为x小于0时f'(x)小于0；x大于0时f'(x)大于0，函数在 $(0,\infty)$ 和 $(-\infty,0)$ 分别是单调递增和单调递减，因此上述值是全局最小值

$f(x)\geq 0\Rightarrow e^{-x}\geq 1-x$

2. 证明 $\forall a$ > 1,下述不等式：

$$e^{-ax}\leq(1-x)^{a}+\frac{1}{2}ax^2$$

对所有 $0\leq x\leq 1$ 成立

(提示说这题有挑战性，吓得我直接去看了solution manual)

首先仍然是构造一个 $f(x)=(1-x)^{a}+\frac{1}{2}ax^2-e^{-ax}$ 。因为f(0)=0，所以证明 $f'(x)\geq 0,\forall x,$ 0 < x < 1就够了（函数的最左端为0且函数单调递增）

$f'(x)=-a (1 - x)^{a - 1}+ a e^{-a x} + a x$ 。整体除去a，且为了方便计算，使b=a-1；最后得到 $g(x)=-(1-x)^b+e^{-(b+1)x}+x$ 。目标变为证明这个式子在0 < x < 1时大于0

从`1`的结论出发，两边提到b次方并乘上-1可以得到 $-e^{-bx}\leq-(1-x)^b$ ,因此 $g(x)\geq -e^{-bx}+e^{-(b+1)x}+x=x-e^{-bx}(1-e^{-x})$ 。不难看出这个式子的值会随着b增大而增大，因此最小值在b=0时得到，于是 $g(x)\geq x-(1-e^{-x})=e^{-x}-(1-x)$

结合`1`的结论便可完成证明

（依然是“虽然我不知道为什么这么做但总之这样做是对的”）

3. 用`2`的结论证明`Theorem 5.38`的上限：

$$Pr(至少拿到一个红球)\leq 1-e^{-\frac{mn}{N}}+\frac{mn^2}{2N^2}$$

提示：a=m, $x=\frac{n}{N}$

提示已经剧透完了，因为用这些值套`2`的结论就能直接得到：

$$e^{-\frac{mn}{N}}-\frac{mn^2}{2N^2}\leq(1-\frac{n}{N})^{m}$$

再配合式子`5.28`的概率值：

$$Pr(至少拿到一个红球)=1-(1-\frac{n}{N})^m$$

即可完成证明

## Exercise 5.36

2. 假设一年有N天（N可以是任何数字），房间内有n个人。推导出类似于`5.28`的公式，用于计算至少有两个人共享生日的概率

Pr(至少有两个人共享生日)=1-Pr(n个人的生日完全不同)= $1-\prod_{i=1}^nPr(第i个人与前i-1个人的生日都不同)=1-\prod_{i=1}^n\frac{N-(i-1)}{N}$

（虽然提示说跟着`Theorem 5.38`的证明，但更好用的是261页有关生日悖论的证明）

3. 对于`2`的概率，找到下列式子的下界：

$$Pr(至少两个人的生日相同)\geq 1-e^{某个关于n和N的函数}$$

这种下界题我试都不用试，最终的结局一定是“问deepseek”

这题需要用`Exercise 5.38`的结论： $\forall x,e^{-x}\geq 1-x$ 。给原结论做个变形： $\prod_{i=1}^n\frac{N-(i-1)}{N}=\prod_{i=1}^n(1-\frac{i-1}{N})=\prod_{k=0}^{n-1}(1-\frac{k}{N})$

接着让 $x=\frac{k}{n}$ ，就有了 $e^{-\frac{k}{n}}\geq 1-\frac{k}{N}$ ；于是 $\prod_{k=0}^{n-1}(1-\frac{k}{N})\leq\prod_{k=0}^{n-1}e^{-\frac{k}{n}}=exp(-\frac{1}{N}\sum_{k=0}^{n-1}k)$

$\sum_{k=0}^{n-1}k=\frac{n(n-1)}{2}$ ，所以 $\prod_{k=0}^{n-1}(1-\frac{k}{N})\leq e^{-\frac{n(n-1)}{2N}}$ 。这样便有了题目要求的下界： $\geq 1-e^{-\frac{n(n-1)}{2N}}$

## Exercise 5.44

这道题描述了Pollard’s ρ分解算法。该算法擅长分解具有质因数p的N，其中p的大小远小于N/p

假设N是合数， $f:Z/NZ\rightarrow Z/NZ$ 是一个混合函数（a mixing function），比如 $f(x)=x^2+1\mod N$ 。与抽象版本的Pollard’s ρ算法类似（`Theorem 5.48`），让 $x_0=y_0$ 为初始值，然后通过设置 $x_{i+1} = f(x_i)$ 和 $y_{i+1} = f(f(y_i))$ 生成序列，并计算 $g_i=gcd(|x_i-y_i|,N)$

1. 假设p是整除N的最小质数。如果f足够随机，说明有高概率得到 $g_k=p,k=O(\sqrt{p})$ 。因此该算法在 $O(\sqrt{p})$ 步内分解N

（我怎么老是跳着看题？明明题目是我自己手抄的，抄完转头就忘了 $y_{i+1} = f(f(y_i))$ 套了两层函数……）

$x_i$ 和 $y_i$ 所属于同一个序列，只是 $y_i$ 一次走两步， $x_i$ 一次走一步，即 $\bar{y_i}=\bar{x_{2i}}$ 。 $g_i=gcd(|x_i-y_i|,N)=p$ 意味着此处的 $x_i$ 和 $y_i$ 模p的余数相等

因为题目已经假设了f足够随机，所以我们可以将序列中得到的每一个数看作是“随机从有p个元素的盒子里取到的元素”。根据前面学过的定理（生日悖论），新取到的元素和之前某次取到的元素相同（两个模n余数不同但模p余数相同的数）平均需要的步数为 $\sqrt{p}$ 。又因为f是一个函数，所以一旦出现重复就会导致序列卡在一个循环中

至于为什么同一个序列需要用 $x_i$ 和 $y_i$ 来记录，因为这是Floyd循环检测算法，可以在O(1)的空间下检测碰撞（区别于普通的碰撞算法，需要 $O(\sqrt{N})$ 大小的空间记录见过的元素）

一个困扰我的地方是“到底是什么发生了循环”。我最开始以为发生循环的元素是模N的，导致我无法理解 $g_i=gcd(|x_i-y_i|,N)$ 是怎么来的， $x_i-y_i$ 不应该是0吗？然后问了chatgpt，它说要拆开来看： $Z_n\leftrightarrow Z_p\times Z_q$ 。由于p小于N其他的因子，出现模p的循环的速度有很大的概率快于出现模其他数的循环的速度。所以前文说的循环都是在模p意义下的，而不是模N

终于明白268页的`Figure 5.1`到底是什么意思了

(其实还是有点云里雾里的。不过接下来的`5.5.1`有详细讲这个算法，先不追究那么多)

本来应该做第五题的，内容大概是“用 $f(x)=x^2-2$ 会发生什么”。简短的答案是会导致生成的随机序列不够随机，函数的像组成的集合很小，很容易导致序列循环过短且难以寻找碰撞，或是直接卡在不动点

但具体的为什么我完全看不明白。AI说“设在模素数p的代数扩张中，有 $\alpha$ 满足 $\alpha+\alpha^{-1}=x_0$ ，那么可以证明 $x_n=\alpha^{2^n}+\alpha^{-2n}$ ,为周期性的指数增长/周期形式”，以及什么“Chebyshev多项式”。我来错地方了，这根本不是我能学会的……

## Exercise 5.43

计算`Theorem 5.48`的证明中出现的积分：

$$I=\int_0^{\infty}t^2e^{-t^2/2}dt$$

提示：将 $I^2$ 写成迭代积分（iterated integral）：

$$I^2=\int_0^{\infty}\int_0^{\infty}x^2e^{-x^2/2}*y^2e^{-y^2/2}dxdy$$

然后转到极坐标系

（我不理解数学，我只是AI数学的搬运工）

直接求I不好求，于是跟着提示走，求 $I^2$ 然后开方。此处为了防止两个t混淆计算，将变量改成了x和y。将积分变形一下：

$$I^2=\int_0^{\infty}\int_0^{\infty}x^2y^2e^{-\frac{x^2+y^2}{2}}dxdy$$

$x^2+y^2$ 的配置对应了提示提到的极坐标系。套用变换公式：
- $x=r\cos\theta$
- $y=r\sin\theta$
- $x^2+y^2=r^2$
- $dxdy=rdrd\theta$

得到 $(r\cos\theta)^2(r\sin\theta)^2e^{-\frac{r^2}{2}}rdrd\theta=r^5\cos^2\theta\sin^2(\theta)e^{-\frac{r^2}{2}}drd\theta$ 。最后再套个 $\theta$ 和r的取值范围(x和y均大于等于0，所以 $\theta$ 取第一象限)就得到了极坐标下的积分：

$$\int_{\theta=0}^{\pi/2}\int_{r=0}^{\infty}r^5\cos^2\theta\sin^2(\theta)e^{-\frac{r^2}{2}}drd\theta$$

因为如下的三个原因：
- 被积函数可分离成两个函数的乘积
- 积分区域是直积（x的范围不依赖于y，y的范围也不依赖于x）
- 积分收敛

所以可以将这个二重积分拆成两个积分的乘积：

$$I^2=[\int_{0}^{\pi/2}\cos^2\theta\sin^2\theta d\theta][\int_{r=0}^{\infty}r^5e^{-\frac{r^2}{2}}dr]$$

此处省略这两个单独的积分的计算过程，总之一个是 $\frac{\pi}{16}$ ，一个是8，乘起来是 $\frac{\pi}{2}$ ，开方就得到了题目要求的积分结果 $\sqrt{\frac{\pi}{2}}$

## Exercise 5.23

E和F为事件

4. 假设 $F_1,...,F_n$ 两两互不相交，且 $F_1\cup...\cup F_n=\Omega$ ( $\Omega$ 指整个样本空间)。证明分解公式(decomposition formula)`5.20`的一般形式：

$$Pr(E)=\sum^n_{i=1}Pr(E|F_i)Pr(F_i)$$

`5.20`说 $Pr(E) = Pr(E | F) Pr(F) + Pr(E | F^c) Pr(F^c)$ ，那么我们可以将 $F_1$ 看作是F，剩下的 $F_i$ 合并起来看作是 $F_c$ 就可以直接套用这个公式

然后对合并起来的 $F_i$ 故技重施，直到所有 $F_i$ 都被分开

5. 证明贝叶斯公式的一般形式：

$$Pr(F_i|E)=\frac{Pr(E|F_i)Pr(F_i)}{Pr(E|F_1)Pr(F_1)+Pr(E|F_2)Pr(F_2)+...+Pr(E|F_n)Pr(F_n)}$$

根据`5.19`，有 $Pr(E|F)=\frac{Pr(F|E)Pr(E)}{Pr(F)}$ 。那么套到这题的背景下就有了 $Pr(F_i|E)=\frac{Pr(E|F_i)Pr(F_i)}{Pr(E)}$ 。Pr(E)的公式在上一题证过了，因此直接放到分母处即可完成证明

## Exercise 5.54

假设F(x)是一个二阶可导函数（twice differentiable）且对于定义域中的所有x，都有F''(x) < 0。证明F是凹函数（concave down），满足式子`5.52`

（没有想到这道题这么难，chatgpt和deepseek的前几次尝试全部失败。最后还是deepseek给了一份没有我能看出的明显错误的证明）

（目前综合下来deepseek做数学题要比chatgpt好，chatgpt在这题疯狂出幻觉）

判定函数凹性有一个一阶条件：对任意p，q，有 $F(q)\leq F(p)+F'(p)(q-p)$ 为了用上这个条件，设 $g(t)=F(tx+(1-t)y),t\in[0,1]$ 。这样设是因为 $g(0)=F(y),g(1)=F(x),g(\lambda)=F(\lambda x+(1-\lambda)y)$ 。将内层的`tx+(1-t)y`看作t的函数，用链式法则可以算出 $g'(t)=F'(tx+(1-t)y)(x-y)$ 。目标变为证明 $g(\lambda)\geq\lambda g(1)+(1-\lambda)g(0)$

由于F''(x) < 0，F自然也满足一阶条件（F'(x)递减）。接下来需要从F满足一阶条件推出g也满足一阶条件。设 $z_{\lambda}=\lambda x+(1-\lambda)y$ ; $z_s=sx+(1-s)y,s\in[0,1]$ 。应用F的一阶条件得到 $F(z_s)\leq F(z_{\lambda})+F'(z_{\lambda})(z_s-z_{\lambda})$ ，而 $z_s-z_{\lambda}=(s-\lambda)(x-y)$ ,所以 $g(s)=F(z_s)\leq g(\lambda)+F'(z_{\lambda})(s-\lambda)(x-y)\Rightarrow g(s)\leq g(\lambda)+g'(\lambda)(s-\lambda)$

接下来从一阶条件推二阶条件。当s=1时， $g(1)\leq g(\lambda)+g'(\lambda)(1-\lambda)$ ;当s=0时， $g(0)\leq g(\lambda)-\lambda g'(\lambda)$ 。将前者乘上 $\lambda$ ，后者乘上 $(1-\lambda)$ ，相加得到 $\lambda g(1) + (1-\lambda) g(0) \le \lambda g(\lambda) + (1-\lambda) g(\lambda) + \big[ \lambda(1-\lambda)g'(\lambda) - \lambda(1-\lambda)g'(\lambda) \big]$ 。化简后得到 $\lambda g(1) + (1-\lambda) g(0) \le g(\lambda)$

最后套回F的定义即可完成证明： $\lambda F(x)+(1-\lambda)F(y)\leq F(\lambda x+(1-\lambda)y)$

## Exercise 5.55

用数学归纳法证明詹森不等式（Jensen’s inequality，`Theorem 5.61`）

没看出来怎么归纳，于是看了solution manual。这里就不再抄一遍了，稍微记录点可能通用的思路

从n推出n+1的关键是怎么用看待n的方式看待n+1。这总结得非常抽象，放在这题指的是把后两项 $a_{n}t_n+a_{n+1}t_{n+1}$ 看作是 $\beta_n\gamma_n$ ，这样虽然有n+1项，实际表现的行为仍然是n项

下一步是意识到 $\beta_n\gamma_n$ 和n的结论似乎没有关系，没法推下一步。没有关系就得找关系。题目的背景提供了潜藏的关系，即所有 $a_i$ 的和为1： $a_1+a_2+...+a_{n-1}+\beta_n=1$ 。这意味着 $\beta_n$ 必须等于 $a_n+a_{n+1}$ ，不然原题设置的关系没法套用到 $\beta_n$ 上。有了 $\beta_n$ 就能得出 $\gamma_n$ 的值了： $\frac{a_{n}t_n+a_{n+1}t_{n+1}}{a_n+a_{n+1}}$

套用n成立时的假设可以得到一个不等式。这个不等式已经和证明的目标很像了，下一步是找出和目标式子不一致的项。这题为右边的 $\beta_n f(\gamma_n)$ 。需要“证明不一样的项实际上和目标项是相等的”，这题表现为证明 $\beta_n f(\gamma_n)=a_n f(t_n)+a_{n+1}f(t_{n+1})$ 。后面应该不是通用思路就不记了，只能说数学家的注意力总是惊人的

## Exercise 5.2

4. 如果要求坐标为满足 $0\leq x_i$ < q的整数，且坐标的顺序不重要——(0, 0, 1, 3)和(1, 0, 3, 0)是一样的;那么一共有多少个n元组 $(x_1,x_2,...,x_n)$ ？

我的超能力是永远想不到简单的思路，而且我的复杂思路永远是错的

我的思路是根据重复的元素进行计数，然后再把结果加起来。比如：
- 假如n元组中没有任何的重复元素，那么总数等于q中选n个不重复元素的方法数
- 假如有一个重复的元素，那么总数等于q乘上q-1个其他元素中选n-2个不重复元素的方法数
- 一直到全部元素都是重复的，这时就是q乘上1

但是太复杂了，我都不知道我在说什么。solution manual中的标准思路是，将这题看成“计算每个数字出现的数量“。比如有 $k_0$ 个0， $k_1$ 个1，等。这样便有了等式 $k_0+k_1+...+k_{q-1}=n$ 。现在问题变成“计算有多少种将n分成q个非负整数的和的方式“。公式为 $\binom{n+q-1}{n}$

这个公式也是一个经典组合学问题[Stars and bars](https://en.wikipedia.org/wiki/Stars_and_bars_(combinatorics))的结果

## Exercise 5.5

2. 假设我们从100个学生中选出第一、第二和第三名，每个人可以从五种奖励中选择一种。假如每种奖励只有一个，一共有多少种可能？

把所有情况的方法数乘在一起：
- 五种奖励选三种： $\binom{5}{3}$
- 三种奖励的排列方式:6
- 100个人中选3个人： $\binom{100}{3}$
- 三个人的排列方式：6

就是答案 $10\times 6\times 161700\times 6=58212000$

3. 与`2`一致，但每种奖励有很多份，因此胜者可以选择任何奖励。现在有多少种可能？

上一题的前两条合并成了一种情况： $5^3$ ，结果为 $125\times\binom{100}{3}\times 6=121275000$

4. 与`3`一致，但我们只是选择三个获胜者，不区分名次。现在有多少种可能？

把“三个人的排列方式”这个情况去掉即可： $125\times\binom{100}{3}=20212500$

## Exercise 5.7

二项式系数有许多有趣的性质。请给出下列恒等式的三个证明：

$$\binom{n}{j}=\binom{n-1}{j-1}+\binom{n-1}{j}$$

1. 对于第一个证明，请利用 $\binom{n}{j}$ 的定义 $\frac{n!}{(n-j)!j!}$

$\frac{(n-1)!}{(n-1-j+1)!(j-1)!}+\frac{(n-1)!}{(n-1-j)!j!}=\frac{n!}{(n-j)!j!}$

2. 对于第二个证明，使用二项式定理（`Theorem 5.10`）比较下列等式两边的 $x^jy^{n-j}$ 项的系数： $(x+y)^n=(x+y)(x+y)^{n-1}$

我看 $(x+y)(x+y)^{n-1}$ 的结构挺像要证的式子的，就感觉得利用这点。然而想了一会没想出来，便回去翻了228页的 $(x+y)^3$ 的例子，然后列出 $(x+y)^4$ 的结果开始瞪眼：

- $x^3+3x^2y+3xy^2+y^3$
- $x^4 + 4 x^3 y + 6 x^2 y^2 + 4 x y^3 + y^4$

分别给第一个式子乘上x和y，发现乘了x的第i项结果和乘了y的第i+1项匹配。比如乘了x的第二项 $3x^3y$ 和乘了y的第一项 $x^3y$ 一致。那如果x所在的项的系数为 $\binom{n-1}{j-1}$ ，y所在的项的系数就是 $\binom{n-1}{j}$ 。就这么凑出来了……

(正确的做法是展开 $(x+y)^{n-1}$ ，然后在展开式的基础上乘上x+y，整理两部分后进行比较。我忘了二项式定理“真的是个式子”，导致我没想到展开式是可以做运算的……怎么会有这么诡异的想法？)

## Exercise 5.21

假设我们抛掷一枚均匀硬币十次，计算如下事件的概率：

4. 正好抛出k次正面和10-k次背面

一共有 $2^{10}$ 种结果；10次里k次是正面的方法数为 $\binom{10}{k}$ 。所以概率是 $\frac{\binom{10}{k}}{2^{10}}$

## Exercise 5.24

有两个装着钢笔和铅笔的罐子。罐子1装着三支钢笔和七支铅笔，罐子2装着八支钢笔和四支铅笔

1. 我们随机选择一个罐子并从中拿出一个物品。这个物品是铅笔的概率有多少？

如果选中罐子1，则拿到铅笔的概率为 $\frac{7}{10}$ ；选中罐子2拿到铅笔的概率则是 $\frac{1}{3}$ 。选中任何罐子的概率都是 $\frac{1}{2}$ ，加起来得到 $\frac{1}{2}(\frac{7}{10}+\frac{1}{3})=\frac{31}{60}$

2. 我们随机选择一个罐子并从中拿出一个物品。如果这个物品是铅笔，它来自罐子1的概率是多少？

用式子`5.19`： $Pr(E|F)=\frac{Pr(F|E)Pr(E)}{Pr(F)}$ 。E是“物品来自罐子1”，F是“物品是铅笔”
- $Pr(F|E)=\frac{7}{10}$
- $Pr(E)=\frac{1}{2}$
- $Pr(F)=\frac{31}{60}$
- $Pr(E|F)=\frac{\frac{7}{10}\times\frac{1}{2}}{\frac{31}{60}}=\frac{21}{31}$

3. 我们随机选择一个罐子并同时拿出两个物品。两个物品都是铅笔的概率是多少？

从罐子1中同时拿出两个铅笔的概率是 $\frac{7}{10}\times\frac{2}{3}$ ；从罐子2中同时拿出两个铅笔的概率是 $\frac{1}{3}\times\frac{3}{11}$ 。加起来得到 $\frac{1}{2}(\frac{7}{15}+\frac{1}{11})=\frac{46}{165}$

## Exercise 5.25

一个罐子里有20个银币和10个金币。你在准备随机抽取一枚硬币的人中排第六位

1. 你抽到金币的概率是多少？

感觉前面的五个人抽到什么硬币的顺序不重要，只需要知道到底抽了多少个金币最后加起来就好。问题是，我怎么算“前5个人中正好有i个人抽到金币”的概率？一个一个列可太麻烦了

瞟了一眼solution manual，我完美地掉进了出题人的陷阱。别说抽到的硬币顺序不重要了，就连站的位置也不重要。乍一看有点反直觉，但假如换一种说法：“随机排列30个硬币，第6个硬币是金币的概率是多少”，这时就很明显是 $\frac{10}{30}=\frac{1}{3}$ 了

虽然确实像我最开始理解的那样存在复杂的条件概率，但这些概率加权平均后结果正好等于初始概率

2. 如果你抽到了金币，前面5个人均抽到银币的概率是多少？

继续bayes。F是“我抽到金币”，E是“前面5个人均抽到银币”
- $Pr(F|E)=\frac{10}{25}$
- $Pr(E)=\frac{20}{30}\times\frac{19}{29}\times\frac{18}{28}\times\frac{17}{27}\times\frac{16}{26}=\frac{2584}{23751}$
- $Pr(E|F)=\frac{\frac{2}{5}\times\frac{2584}{23751}}{\frac{10}{30}}=\frac{5168}{39585}$

# Elliptic Curves and Cryptography

椭圆曲线我来了！

## Exercise 6.3

假设三次多项式 $X³ + AX + B$ 可以分解为 $(X-e_1)(X-e_2)(X-e_3)$ ，证明 $4A^3+27B^2=0$ 当且仅当 $e_1,e_2,e_3$ 中至少有两个是重复的

提示：展开式子并比较系数，尝试将A和B与 $e_1,e_2,e_3$ 联系起来

记 $e_1=a,e_2=b,e_3=c$ ，展开后可以得到这样一个鬼东西： $-a b c + a b x + a c x - a x^2 + b c x - b x^2 - c x^2 + x^3$ 。由此可以推断：
- -a-b-c=0
- -abc=B
- ab+ac+bc=A

用wolfram alpha计算这两个条件（ $4(ab+ac+bc)^3+27(-abc)^2=0,-a-b-c=0$ ），发现要么c或b等于a，要么b和c都等于 $-\frac{a}{2}$ 。虽然是“机械降神”，但应该算是证明了一个方向（式子等于0 $\Rightarrow$ 至少有两个重复值）

如果有两个值重复（假设是a和b），我们可以进一步得到如下的关系：
- -2a-c=0
- $-a^2c=B$
- $a^2+2ac=A$

结合 $4(a^2+2ac)^3+27(-a^2c)^2,-2a-c=0$ 便可得到 $a^3 (27 a c^2 + 4 (a + 2 c)^3) = 0$

## Exercise 6.22

设E为椭圆曲线，满足generalized Weierstrass方程：

$$E:Y^2+a_1XY+a_3Y=X^3+a_2X^2+a_4X+a_6$$

假设 $P_1=(x_1,y_1),P_2=(x_2,y_2)$ 是E上的点。证明下述算法计算的是两者的和 $P_3=P_1+P_2$

首先，如果 $x_1=x_2$ 且 $y_1+y_2+a_1x_2+a_3=0$ ，那么 $P_1+P_2=O$

否则按照如下规则定义 $\lambda$ 和v：
- 如果 $x_1\not=x_2,\lambda=\frac{y_2-y_1}{x_2-x_1},v=\frac{y_1x_2-y_2x_1}{x_2-x_1}$
- 如果 $x_1=x_2,\lambda=\frac{3x_1^2+2a_2x_1+a_4-a_1y_1}{2y_1+a_1x_1+a_3},v=\frac{-x_1^3+a_4x_1+2a_6-a_3y_1}{2y_1+a_1x_1+a_3}$

那么：

$$P_3=P_1+P_2=(\lambda^2+a_1\lambda-a_2-x_1-x_2,-(\lambda+a_1)x_3-v-a_3)$$

检查 $P_1+P_2$ 是否等于O的代码其实就是345页提到的反射公式

（将方程看成Y的一元二次方程，原点和像点就是方程的两个根。用韦达定理即可推出两个点之间的Y坐标的关系）

接下来模仿319页对普通Weierstrass方程加法的证明。算法中的 $\lambda$ 是过两个点的直线的斜率。设过两点的直线的方程为 $y=\lambda x+t(t=y_1-\lambda x_1)$ ，代入曲线方程找第三个交点： $(\lambda x+t)^2+a_1x(\lambda x+t)+a_3(\lambda x+t)=x^3+a_2x^2+a_4x+a_6$ 。展开得到 $-a_1 t x - a_3 t - a_1 λ x^2 + a_2 x^2 - a_3 λ x + a_4 x + a_6 - t^2 - 2 λ t x + x^3 - λ^2 x^2 = 0$ （额外乘了一个-1，不然结果的符号不完全一样）。我们知道这个方程有三个根，可以写成 $(X-x_1)(X-x_2)(X-x_3)$ ，其 $x_2$ 项的系数是 $-x_1-x_2-x_3$ ；展开式中 $x_2$ 项对应的系数为 $-a_1\lambda+a_2-\lambda^2$ 。由此可以推出 $x_3=a_1\lambda-a_2+\lambda^2-x_1-x_2$

最后可以从 $\lambda,x_3,t$ 推出 $y_3=\lambda x_3+t$ ，套个反射公式就得到了题目要证的形式

$x_1=x_2$ 的情形类似，只不过 $\lambda$ 给的是切线的斜率

## Exercise 6.24

假设 $\tau(\alpha)=\alpha^p$ 为 $F_{p^k}$ 上的Frobenius映射

3. 假设E是 $F_p$ 上的椭圆曲线， $\tau(x,y)=(x^p,y^p)$ 为 $E(F_{p^k})$ 到自身的Frobenius映射。证明 $\tau(P+Q)=\tau(P)+\tau(Q),\forall P,Q\in E(F_{p^k})$

347页证明6.10时指出这题的证明差不多，算是个提示吧（此处省略`Theorem 6.6`中加法的定义）

$\tau(P+Q)=((\lambda^2-x_1-x_2)^p,(\lambda(x_1-x_3)-y_1)^p)$

$\tau(P)+\tau(Q)=(x_1^p,y_1^p)+(x_2^p,y_2^p)=(\lambda'^2-x_1^p-x_2^p,\lambda'(x_1^p-x_3')-y_1^p)$

因为 $\lambda$ 和上述式子中仅包含加法和乘法，而 $\tau$ 保持加法和乘法，因此可以得出两个x，y分量是相等的

另外，我最开始有些疑惑为什么前面说“E是 $F_p$ 上的椭圆曲线”，后面又讨论的是 $E(F_{p^k})$ 上的映射；后面意识到 $F_p$ 上的点本身就包含在 $F_{p^k}$ 上。这似乎就是所谓的“基变换”

## Exercise 6.27

假设 $\tau$ 满足 $\tau^2=-2-\tau$ 。证明下述算法能够给出 $v_i\in$ {-1,0,1}，使得正整数n满足 $n=v_0+v_1\tau+v_2\tau^2+...+v_l\tau^l$ ；并证明 $l\leq 2\lceil log(n)\rceil+1$

1. Set $n_0 = n$ and $n_1 = 0$ and i = 0
2. Loop while $n_0 \not= 0$ or $n_1 \not= 0$
3. If $n_0$ is odd
4. Set $v_i = 2 − ((n_0 − 2n_1)\mod 4)$
5. Set $n_0 = n_0 − v_i$
6. Else
7. Set $v_i = 0$
8. End If
9. Set i = i + 1
10. Set $(n_0, n_1) = (n_1-\frac{1}{2}n_0,-\frac{1}{2}n_0)$
11. End Loop

突然就完全看不懂了……deepseek说这是代数整数，啥时候学了这玩意？

回到这题的背景`Proposition 6.30`。书中提到 $\tau$ 满足 $\tau^2(P)+\tau(P)+2P=O$ ，即 $\tau^2+\tau+2=0$ ，然后可以将n写成 $\tau$ 的次方之和。从这里我就开始糊涂了， $\tau$ 不是映射吗，怎么突然可以用来表示整数了？

deepseek解释说， $\tau$ 是代数整数，或者说是首一整系数多项式 $\tau^2+\tau+2=0$ 的根。利用 $\tau^2=-2-\tau$ 可将任何高于 1 次方的 $\tau$ 的幂降低到不超过 1 次方。至于为什么要降幂，因为如果不降的话，同一个元素可能有多种表达方式，不方便比较和计算

计算方面没有什么特别的，整数的加减法和乘法没有任何差别，涉及 $\tau$ 的部分用特征方程降次就好

理解上述算法的关键是除法。在 $Z[\tau]$ 中，任何元素都可以写成 $a+b\tau,a,b\in Z$ 的形式。这里的a和b就是算法中的 $n_0$ 和 $n_1$ 。最开始时 $a=1,b=0$ ，因为 $n=n+0\tau$ 。接下来把这个数除以 $\tau$ ，使得 $a+b\tau=v+(a'+b'\tau)\tau$ 。进一步展开得到 $(a'+b'\tau)\tau=a'\tau+b'\tau^2=a'\tau+b'(-2-\tau)=-2b'+(a'-b')\tau$

从 $a+b\tau=v-2b'+(a'-b')\tau$ 可以看出，a=v-2b',b=a'-b'。a和b是当前轮的 $n_0$ 和 $n_1$ ，a'和b'则是下一轮的，反过来便可以算出下一轮的 $n_0$ 和 $n_1$ : $b'=\frac{v-a}{2},a'=b+\frac{v-a}{2}$ 。既然出现了除法，我们便要保证结果是整数，即 $v\equiv a\mod 2$

查看算法计算 $v_i$ 的过程，假如 $n_0$ 是偶数的话， $v_i$ 也是0；$n_0$ 是奇数的话，不难看出 $(n_0-2n_1)\mod 4$ 的结果只能是1或者3，进而 $2-((n_0-2n_1)\mod 4)$ 的结果只能是1或者-1。两种情况的同余类皆一致，且顺手完成了 $v_i\in$ {-1,0,1}的证明

最后会发现 $b'=\frac{v-a}{2},a'=b+\frac{v-a}{2}$ 似乎与算法写的 $(n_0, n_1) = (n_1-\frac{1}{2}n_0,-\frac{1}{2}n_0)$ 不一样。这是因为算法第5步已经减过 $v_i$ 了

问题的第二小问和范数有关。 $Z[\tau]$ 中的元素的范数的定义为 $N(z)=n_0^2-n_0n_1+2n_1^2$ ，于是初始情况下 $N(n+0r)=n^2$ 。 $\tau$ 的范数为2，算法在每一步除以 $\tau$ ；重复以上步骤，直到范数小于2时停止（此时数字很小，可以直接表示，不需要除了）。那么有： $\frac{n^2}{2^k}\lesssim 2\Rightarrow 2^k\gtrsim\frac{n^2}{2}\Rightarrow k\gtrsim 2log_2(n)-1\Rightarrow l\gtrsim 2log_2(n)-2$ 。这里只是非常粗略的估计（甚至不是题目要求的上界），完整结果还需要进一步分析范数的严格不等式得到

## Exercise 6.30

本练习简述了对“如果P = (α, 0) ∈ E, 则 div(X − α) = 2[P] − 2[O]“命题的证明

1. 证明对于某个大于等于1的整数m，有 $div(X-\alpha)=m[P]-m[O]$

Bilinear Pairings这节从开始就懵，特别是divisor相关的内容。我甚至不知道怎么描述我哪里不懂，这回AI也救不了了

椭圆曲线E上有理函数f的除子定义为 $div(f) = \sum_{P\in E}n_P[P]$ ，其中 $n_P$ 的符号由P是零点（正数）还是极点（负数）决定；值由P是多少阶的零点/极点决定。[P]是'点P'这个位置的代数标记，没有什么复杂的含义

在计算X − α的除子时，其零点就是x=α的那些点，即 $P=(α,0)\in E$ ；而且不存在第二个y坐标是0的点Q，所以其除子的表达式一定有m[P]部分

但是我不明白极点。在我浅薄的知识体系里，有理函数的极点是导致其未定义（比如常见的除以0）的数。X − α有这玩意吗？

问了chatgpt，它说坐标函数X本身就是有理函数，在无穷远点𝑂处有极点。可以这么理解：椭圆曲线并不是在仿射平面里结束的，它被补上了一个无穷远点𝑂。当沿着曲线“往无穷远走”时，𝑥的值会变得越来越大，因此在 𝑂的局部坐标中，𝑥发散，于是 𝑥在𝑂是极点。由此可以得出除子的定义中有k[O]部分

最后用`Theorem 6.36`的`b`项可以知道，E上的有理函数的除子一定满足deg(D)=0，所以m=k

2. 证明E的Weierstrass方程可写作 $E:Y^2=(X-\alpha)(X^2+aX+b)$ ,且 $X-\alpha$ 和 $X^2+aX+b$ 没有相同的根

$(X-\alpha)(X^2+aX+b)=X^3+(a-α) X^2+(b-a α)X-ab$ 。由此看出a=α,则 $A=b-a^2,B=-ab$ 就是标准的Weierstrass方程了。另外提一嘴，此处分解出X-α是因为题目假设P = (α, 0) ∈ E

`Exercise 6.3`里证过，非奇异椭圆曲线Weierstrass方程的三个根都是不重复的，自然X-α和 $X^2+aX+b$不能有相同的根

3. 证明对于某个大于等于1的整数n， $div(X-\alpha)=2n[P]+2n[O]$

提示：在等式 $Y^2 = (X − α)(X^2 + aX + b)$ 的两边均应用除子，然后用`2`的结论

$div(Y^2)=div((X − α)(X^2 + aX + b))=div(X-α)+div(X^2 + aX + b)=m[P]-m[O]$ 。现在看怎么算 $Y^2$ 的除子

因为 $P=(α,0)\in E$ ，可知Y函数在 $\alpha$ 处有个零点，假设为n阶。 $div(Y^2)=2div(Y)$ ，所以 $div(Y^2)$ 包含2n[P]项。另一边，已知div(X-α)有m[P]项，有一个根 $\alpha$ ；用`2`的结论可得到 $X^2 + aX + b$ 一定没有根α，故不含任何[P]项。结合上述两个结论便能得出2n=m

4. 证明 $div(X-\alpha)=2[P]-2[O]$

警告：此题需要一些本书没有介绍的离散赋值环（discrete valuation ring，DVR）的知识

（这书没介绍的多了去了）

看来得让AI代打一下DVR了。从整数开始熟悉一下“赋值”的概念：如果取一个固定质数p，则每个非零整数n都可以写成 $p^km$ ，其中m不被p整除，k大于等于0并且是唯一的。此时称这个k为n在p处的赋值，记作 $v_p(n)$ 。有理数要多些花样。假设 $a=p^ka',b=p^lb'$ ，则 $\frac{a}{b}$ 在p处的赋值为k-l

接下来把上述概念移植到多项式环上。取某个点a，每个非零多项式都可以写成 $f(x)=(x-a)^kg(x)$ （x-a可以说是多项式环里的“质数”）,其中g(a)不为0。那么f在x=a处的赋值是 $v_a(f)=k$ ，仍然是唯一的。同样可以扩展到有理函数。假设 $R(x)=\frac{f(x)}{g(x)}$ ，则 $v_a(R)=v_a(f)-v_a(g)$

观察两者的共同点后可以抽象出DVR的定义：
- 有一个环 R（比如整数环 Z和多项式环C[x]）
- 有一个元素 π 扮演“局部参数”的角色（对整数是素数 p，对多项式是 x−a）
- 每个R和其分式域（在原本的环中加上“分数”，补全除法的概念。比如Q是Z的分式域）中的非零元都可以唯一写成 $r=π^ku$ ，其中 u 在 R 中可逆
- 定义赋值v(r)=k
- 满足这些条件的环就叫DVR。名称“离散”来源于赋值只能是离散的整数值

回到这题的背景。在曲线上一个点 P 附近，局部参数就是一个“好的坐标”，它能唯一确定附近的点；局部参数 π 是在 P 点附近定义的一个函数，满足：
- $\pi(P)=0$
- $v_P(\pi)=1$
- 局部环的极大理想由 π 生成，或者说所有在 P 消失的函数，都含 π

Y是局部参数。 $v_P(Y)=1$ , $v_P(Y^2)=2$ ，因此 $v_P(X-\alpha)=v_P(Y^2)-v_P(X^2 + aX + b)=2$

呃我完全没搞懂，根本不知道怎么描述哪里不会。这AI说的对不对啊？关键这一题又没有答案，我更不可能半路跑出去学一下代数几何。一切交给未来的我（

## Exercise 6.32

本练习要求你验证 Weil 配对 $e_m$ 是否定义良好

1. 证明 $e_m(P,Q)$ 的值与有理函数 $f_P,f_Q$ 的选择无关

虽然solution manual没有答案，但 https://digitalcommons.unf.edu/cgi/viewcontent.cgi?article=1138&context=etd 的38页有一模一样的题

`Theorem 6.36`告诉我们，如果两个有理函数的除子是一样的，那么存在一个非零常数c，使得f=cg。意味着用 $f_P'$ 和 $f_Q'$ 算的Weil配对 $\frac{f_P'(Q+S)}{f_P'(S)}/\frac{f_Q'(P-S)}{f_Q'(-S)}=\frac{cf_P(Q+S)}{cf_P(S)}/\frac{c'f_Q(P-S)}{c'f_Q(-S)}=\frac{f_P(Q+S)}{f_P(S)}/\frac{f_Q(P-S)}{f_Q(-S)}$

2. 证明 $e_m(P,Q)$ 的值与辅助点S无关

提示：固定点P和Q并考虑函数 $F(S)=\frac{f_P(Q+S)}{f_P(S)}/\frac{f_Q(P-S)}{f_Q(-S)}$ 。计算F的除子，并利用以下事实：定义在 E 上的每个非常数函数至少有一个零点

这个函数的零点只出现在：
- S=P-Q
- S=P
- S=-Q
- S=O

然而6.16的定义要求S $\not\in$ {O, P, −Q, P − Q}，因此这个函数没有任何极点和零点，是一个常数函数

## Exercise 6.31

证明Weil配对满足 $e_m(P,Q)=e_m(Q,P)^{-1},\forall P,Q\in E[m]$

提示： $e_m(P+Q,P+Q)=1$ ，然后利用双线性（bilinearity）展开

看`Theorem 6.38`，用双线性可以得到 $e_m(P,P+Q)e_m(Q,P+Q)=e_m(P,P)e_m(P,Q)e_m(Q,P)e_m(Q,Q)=1$ 。因为 $e_m(P,P)=e_m(Q,Q)=1$ ，所以 $e_m(P,Q)e_m(Q,P)=1$ ，由此得到 $e_m(P,Q)=e_m(Q,P)^{-1}$

## Exercise 6.33

给E[m]选择一组基底{ $P_1,P_2$ }，并将所有E[m]中的点P写成基底的线性组合 $P=a_PP_1+b_PP_2$ （见`Remark 6.39`）。用`Theorem 6.38`提到的Weil配对的基本性质，证明：

$$e_m(P,Q)=e_m(P_1,P_2)^{det\begin{pmatrix}
a_P&a_Q \\
b_P&b_Q
\end{pmatrix}}=e_m(P_1,P_2)^{a_Pb_Q-a_Qb_P}$$

用双线性可以推出 $e_m(aP,Q)=e_m(P,aQ)=e_m(P,Q)^a$ ，因为 $e_m(2P,Q)=e_m(P+P,Q)=e_m(P,Q)e_m(P,Q)$

$e_m(P,Q)=e_m(a_PP_1+b_PP_2,a_QP_1+b_QP_2)=e_m(a_PP_1,a_QP_1)e_m(a_PP_1,b_QP_2)e_m(b_PP_2,a_QP_1)e_m(b_PP_2,b_QP_2)=e_m(P_1,P_1)^{a_Pa_Q}e_m(P_1,P_2)^{a_Pb_Q}e_m(P_2,P_1)^{b_Pa_Q}e_m(P_2,P_2)^{b_Pb_Q}=e_m(P_1,P_2)^{a_Pb_Q-b_Pa_Q}$

## Exercise 6.39

假设E是 $F_p$ 上的椭圆曲线，l是质数。再假设 $E(F_p)$ 中有一个l阶的点，l > $\sqrt{p}+1$ 。证明 $E(F_p)[l]\cong Z/lZ$

`Theorem 6.11`(Hasse)告诉我们， $N:=#E(F_p)=p+1-t_p,t_p\leq 2\sqrt{p}$ 。 $E(F_p)[l]$ 是两个Abel群的交集 $E[l]\cap E(F_p)$ ，因此也是一个群。由于 $E(F_p)$ 中有一个l阶的点，这个群是非平凡子群；而作为有限Abel群的非平凡子群，它只有两种可能：
- Z/lZ
- $Z/lZ\times Z/lZ$

但它不可能是后面这种情况，因为l > $\sqrt{p}+1\Rightarrow l^2$ > $(\sqrt{p}+1)^2$ > N